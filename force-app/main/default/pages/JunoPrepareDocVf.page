<apex:page controller="JunoPrepareandSend" applyBodyTag="false" sidebar="false" showHeader="false" title="Object Selector" >
    <apex:slds />
    <apex:includeLightning />
    <html>
        <head>
            
            <meta charset="UTF-8" />
            <meta name="viewport" content="width=device-width, initial-scale=1"/>
            
            <script>
                debugger;
                <apex:includeScript value="{!$Resource.SigJuerymin_js}" />
                <apex:includeScript value="{!$Resource.SigJueryuimin_js}" />   
                <apex:includeScript value="{!$Resource.prepareandsend_jQuery12}" />   
                <apex:includeScript value="{!$Resource.prepareandsend_jQueryUI13}" />    
                console.log('ggg')
            </script>
            <style type="text/css">
                
                #the-canvas {
                border: 1px solid black;
                direction: ltr;
                }
                
            </style>
        </head>
        <apex:form id="FormId">
            
            <!-- send function --> 
            
            <apex:actionFunction name="savePageTabsPos" action="{!savePageTabsVal}"  reRender="FormId" oncomplete="redirect()">
                <apex:param name="pageTabPosListVal" value="" assignTo="{!pageTabPosListVal}"/>
                <apex:param name="recipentList" value="" assignTo="{!recipentList}"/>
            </apex:actionFunction>
            
            <apex:actionFunction name="callUserSignpage" action="{!callUserSignpage}"   oncomplete="redirectToSign()">
                
            </apex:actionFunction>
            
            <apex:actionFunction name="pageReferencecall" action="{!pageReferencecall}"  >
            </apex:actionFunction>
            
            
            <body>
                <div id="mainContainer" style="text-align:center;">
                    
                </div>
            </body>
            
        </apex:form>
        <script>
        
        var canvasurlArr = [];
        function redirect(){
            console.log('redirect')
            if('{!isInPerson}' == 'true'){
                debugger;
                //redirectToSign();
                callUserSignpage()
            }else{
                //pageReferencecall();
                window.open("/"+'{!recordId}','_top')
            }
        }
        
        function redirectToSign(){
            debugger;
            //pageReferencecall()
            window.open("/"+'{!recordId}','_top')
        }
        
        
        var BASE64_MARKER = ';base64,';
        
        function convertDataURIToBinary(dataURI) {
            var base64Index = dataURI.indexOf(BASE64_MARKER) + BASE64_MARKER.length;
            var base64 = dataURI.substring(base64Index);
            var raw = window.atob(base64);
            var rawLength = raw.length;
            var array = new Uint8Array(new ArrayBuffer(rawLength));
            
            for(var i = 0; i < rawLength; i++) {
                array[i] = raw.charCodeAt(i);
            }
            debugger;
            var blob = new Blob( [array], { type: "application/pdf" });
            var url = URL.createObjectURL(blob);
            return array;
        }
        
        
        function base64toPDFs(){
            
            
            var link = document.createElement('a');
            //  link.href = 'data:application/pdf;base64,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bnRzIDUgMCBSL1R5cGUvUGFnZS9SZXNvdXJjZXM8PC9Qcm9jU2V0IFsvUERGIC9UZXh0IC9JbWFnZUIgL0ltYWdlQyAvSW1hZ2VJXS9Gb250PDwvRjEgMiAwIFIvRjIgMyAwIFIvRjMgNCAwIFI+Pj4+L1BhcmVudCA2IDAgUi9NZWRpYUJveFswIDAgNjY5LjYgOTAyLjg5XT4+CmVuZG9iago0IDAgb2JqPDwvU3VidHlwZS9UeXBlMS9UeXBlL0ZvbnQvQmFzZUZvbnQvSGVsdmV0aWNhL0VuY29kaW5nL1dpbkFuc2lFbmNvZGluZz4+CmVuZG9iagoyIDAgb2JqPDwvU3VidHlwZS9UeXBlMS9UeXBlL0ZvbnQvQmFzZUZvbnQvVGltZXMtUm9tYW4vRW5jb2RpbmcvV2luQW5zaUVuY29kaW5nPj4KZW5kb2JqCjMgMCBvYmo8PC9TdWJ0eXBlL1R5cGUxL1R5cGUvRm9udC9CYXNlRm9udC9IZWx2ZXRpY2EtQm9sZC9FbmNvZGluZy9XaW5BbnNpRW5jb2Rpbmc+PgplbmRvYmoKNiAwIG9iajw8L0tpZHNbMSAwIFJdL1R5cGUvUGFnZXMvQ291bnQgMT4+CmVuZG9iago3IDAgb2JqPDwvVHlwZS9DYXRhbG9nL1BhZ2VzIDYgMCBSPj4KZW5kb2JqCjggMCBvYmo8PC9Nb2REYXRlKEQ6MjAyMTAzMDkwOTQ3MTZaKS9DcmVhdGlvbkRhdGUoRDoyMDIxMDMwOTA5NDcxNlopL1Byb2R1Y2VyKGlUZXh0IDIuMC44IFwoYnkgbG93YWdpZS5jb21cKSk+PgplbmRvYmoKeHJlZgowIDkKMDAwMDAwMDAwMCA2NTUzNSBmIAowMDAwMDAyNjg1IDAwMDAwIG4gCjAwMDAwMDI5NTEgMDAwMDAgbiAKMDAwMDAwMzA0MCAwMDAwMCBuIAowMDAwMDAyODY0IDAwMDAwIG4gCjAwMDAwMDAwMTUgMDAwMDAgbiAKMDAwMDAwMzEzMiAwMDAwMCBuIAowMDAwMDAzMTgyIDAwMDAwIG4gCjAwMDAwMDMyMjYgMDAwMDAgbiAKdHJhaWxlcgo8PC9JbmZvIDggMCBSL0lEIFs8YjU0MWY1NmJlMmI2ZWVlYmQ0MTNmZTlmMDdhNzMzNWQ+PGJjMjAzYTEyM2M4MDY5ZmQ4MDAwYWE3MDBkYjgyNmFhPl0vUm9vdCA3IDAgUi9TaXplIDk+PgpzdGFydHhyZWYKMzM0NQolJUVPRgo=';
            
            link.href = '{!body}'+''+'{!secondbody}';
            
            debugger;
            //addScript('https://officetohtml.js.org/pages/include/pdf/pdf.js');
            
            //document.getElementById('viewerContainer')
            
            if('{!body}' != ''){
                var pdfData = convertDataURIToBinary(link.href);//new Uint8Array(this.result);
                // Using DocumentInitParameters object to load binary data.
                //console.log('defaultOptions',defaultOptions); 
                
            }
        }
        
        var loadedPages = [];
        var eleIndex = 0;
        var pageTabPosList = [];
        var receiverData= JSON.parse('{!JSENCODE(receiverList)}');
        
        
        function rebuildForSign(){
            // var pageTabPosList = [];
            debugger;
            var receiverData= JSON.parse('{!JSENCODE(receiverList)}');
            console.log(receiverData);
            
            
            savePageTabsPos(JSON.stringify(pageTabPosList));
        }

        
       
        var fileBlobValue =  '{!body}'+''+'{!secondbody}';
        //var url = '//raw.githubusercontent.com/mozilla/pdf.js/ba2edeae/web/compressed.tracemonkey-pldi-09.pdf';
        
       
        
        var pdfDoc = null,
            pageNum = 1,
            pageRendering = false,
            pageNumPending = null,
            //scale = 0.8,
            scale = 1.45;
 
        rebuildForSign()
        
        </script>
    </html>
</apex:page>